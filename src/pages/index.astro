---
import BaseLayout from '../layouts/BaseLayout.astro';
const base = import.meta.env.BASE_URL;
---

<BaseLayout
  title="bunchoniki Store - 厳選サイドロードアプリカタログ"
  description="Apple Silicon対応デバイス向けの厳選アプリを集めたカタログ。Delta、UTM、SideStoreなど。"
>
  <main>
    <!-- ヒーローセクション -->
<section class="bg-white py-16 lg:py-24">
  <div class="max-w-6xl mx-auto px-6">

    <div class="grid gap-8 lg:grid-cols-2 items-center">
      <div class="flex flex-col justify-center">
        <span class="inline-block text-xs font-semibold bg-blue-100 text-blue-700 px-3 py-1 rounded-full w-fit mb-5">
          信頼できるリポジトリ
        </span>

        <h1 class="text-3xl sm:text-4xl font-bold leading-tight tracking-tight text-gray-900">
          iPhoneを、<br>
          <span class="text-blue-600">もっと自由に。</span>
        </h1>

        <p class="mt-5 text-gray-600 leading-relaxed max-w-md">
          日本向けの安全なAltStoreリポジトリ。
          公式ソースのみ掲載し、初心者でも安心して利用できます。
        </p>

        <div class="mt-8 flex items-center gap-5">
          <a href={`${base}apps`}
            class="inline-flex items-center px-6 py-3 bg-blue-600 text-white rounded-lg font-medium shadow hover:bg-blue-700 transition">
            アプリを探す →
          </a>

          <a href={`${base}articles/`}
            class="text-sm text-gray-500 hover:underline">
            初めての方はこちら
          </a>
        </div>
      </div>

      <!-- image -->
      <div class="flex justify-center">
        <div class="w-36 sm:w-44 lg:w-52 rounded-2xl shadow-lg overflow-hidden border-4 border-gray-900 bg-gradient-to-br from-blue-500 to-purple-600">
          <!-- 正方形に変更 -->
          <div class="aspect-square flex flex-col items-center justify-center text-white p-6">
            <img
              src={`${base}assets/img/logo.png`}
              alt="bunchoniki Store ロゴ"
              class="w-1/2 opacity-95 mb-3"
            />
            <p class="text-base font-bold leading-tight text-center">
              bunchoniki Store
            </p>
            <p class="text-xs opacity-80 mt-1">
              Safe & Secure
            </p>
          </div>
        </div>
      </div>

    </div>

    <!-- feature cards -->
    <div class="mt-8 grid gap-4 sm:grid-cols-3">
      <div class="bg-white border border-gray-100 p-4 rounded-xl">
        <div class="flex items-center gap-2 mb-1">
          <svg class="w-5 h-5 text-blue-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4"/>
          </svg>
          <h3 class="font-semibold text-sm">公式ソース直結</h3>
        </div>
        <p class="text-xs text-gray-600">開発者の公式リポジトリから直接取得。</p>
      </div>
      <div class="bg-white border border-gray-100 p-4 rounded-xl">
        <div class="flex items-center gap-2 mb-1">
          <svg class="w-5 h-5 text-blue-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 15v2m-6 4h12"/>
          </svg>
          <h3 class="font-semibold text-sm">厳格な安全基準</h3>
        </div>
        <p class="text-xs text-gray-600">オープンソース確認と公証チェック。</p>
      </div>
      <div class="bg-white border border-gray-100 p-4 rounded-xl">
        <div class="flex items-center gap-2 mb-1">
          <svg class="w-5 h-5 text-blue-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"/>
          </svg>
          <h3 class="font-semibold text-sm">初心者にやさしい</h3>
        </div>
        <p class="text-xs text-gray-600">日本語で丁寧に解説。</p>
      </div>
    </div>

  </div>
</section>


    <!-- 特徴セクション -->
    <section class="py-12 sm:py-14 lg:py-16 px-4 bg-slate-50">
      <div class="max-w-6xl mx-auto">
        <h2 class="text-3xl font-bold text-center mb-12 text-gray-900">当サイトの特徴</h2>
        <div class="grid grid-cols-1 md:grid-cols-3 gap-8">
          <div class="bg-white rounded-xl p-8 border border-gray-200">
            <div class="mb-4">
              <span class="material-symbols-outlined feature-icon">verified</span>
            </div>
            <h3 class="text-xl font-bold mb-2 text-gray-900">ダブルチェック体制</h3>
            <p class="text-gray-700">アプリの性質に合わせて「オープンソースによる透明性」または「Appleによる公証」のいずれかを確認済み。根拠のない危険な野良アプリは一切扱いません。</p>
          </div>
          <div class="bg-white rounded-xl p-8 border border-gray-200">
            <div class="mb-4">
              <span class="material-symbols-outlined feature-icon">menu_book</span>
            </div>
            <h3 class="text-xl font-bold mb-2 text-gray-900">丁寧な解説</h3>
            <p class="text-gray-700">新法対応やサイドローディングの基礎を分かりやすく説明。</p>
          </div>
          <div class="bg-white rounded-xl p-8 border border-gray-200">
            <div class="mb-4">
              <span class="material-symbols-outlined feature-icon">language</span>
            </div>
            <h3 class="text-xl font-bold mb-2 text-gray-900">日本語対応</h3>
            <p class="text-gray-700">すべてのコンテンツが日本語。英語が苦手でも安心です。</p>
          </div>
        </div>
      </div>
    </section>

    <!-- 配布方法の違い --><section class="py-10 px-4 bg-white border-t border-gray-100">
  <div class="max-w-6xl mx-auto">

    <h2 class="text-2xl font-bold text-center mb-2 text-gray-900">
      配布方法の違い
    </h2>
    <p class="text-sm text-gray-600 text-center mb-8">
      インストール方法が異なります
    </p>

    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">

      <div class="bg-green-50 rounded-xl p-5 border border-green-200">
        <h3 class="text-lg font-semibold mb-3 text-gray-900">App Store配信</h3>
        <ul class="text-sm text-gray-700 space-y-1 list-disc list-inside">
          <li>自動更新</li>
          <li>署名不要</li>
          <li>PC不要</li>
        </ul>
      </div>

      <div class="bg-yellow-50 rounded-xl p-5 border border-yellow-200">
        <h3 class="text-lg font-semibold mb-3 text-gray-900">IPA配布（7日署名）</h3>
        <ul class="text-sm text-gray-700 space-y-1 list-disc list-inside">
          <li>7日ごと再署名</li>
          <li>AltStore/SideStore利用</li>
          <li>非公開アプリも導入可能</li>
        </ul>
      </div>

    </div>
  </div>
</section>

    <!-- 人気アプリ（Google Sheets API） -->
    <section class="py-12 sm:py-14 lg:py-16 bg-slate-50">
      <div class="max-w-6xl mx-auto">
        <h2 class="text-3xl font-bold text-center mb-12 text-gray-900 px-4">人気のアプリ</h2>

        <div id="apps-loading" class="flex justify-center items-center py-16">
          <div class="flex flex-col items-center gap-4">
            <div class="animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600"></div>
            <p class="text-gray-500 text-sm">アプリを読み込み中...</p>
          </div>
        </div>

        <div id="apps-content" class="hidden">
          <div id="slideshow-container" class="md:hidden relative px-4">
            <div class="relative overflow-hidden">
              <div id="featured-apps-mobile" class="flex transition-transform duration-500 ease-out"></div>
            </div>
            <button id="prev-btn" class="opacity-30 absolute left-2 top-1/2 -translate-y-1/2 bg-white/50 hover:bg-white/70 text-gray-800 rounded-full p-2 shadow-lg transition z-10">
              <span class="material-symbols-outlined">chevron_left</span>
            </button>
            <button id="next-btn" class="opacity-30 absolute right-2 top-1/2 -translate-y-1/2 bg-white/50 hover:bg-white/70 text-gray-800 rounded-full p-2 shadow-lg transition z-10">
              <span class="material-symbols-outlined">chevron_right</span>
            </button>
            <div id="dots-container" class="flex justify-center gap-2 mt-6"></div>
          </div>
          <div id="featured-apps-desktop" class="hidden md:grid md:grid-cols-3 gap-6 px-4"></div>
        </div>

        <div class="text-center mt-12 px-4">
          <a href={`${base}apps`} class="btn-primary text-lg">すべてのアプリを見る</a>
        </div>
      </div>
    </section>

    <!-- 記事セクション -->
    <section class="py-12 sm:py-14 lg:py-16 px-4 bg-white">
      <div class="max-w-6xl mx-auto">
        <h2 class="text-3xl font-bold text-center mb-4 text-gray-900">詳しく学ぶ</h2>
        <p class="text-gray-700 text-center mb-12">サイドローディングやアプリの選び方について、丁寧に解説した記事をご用意しています。</p>

        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6 mb-12">
          <a href={`${base}articles/what-is-sideloading`} class="bg-white rounded-xl p-6 border border-gray-200 hover:border-gray-300 hover:shadow-md transition-all">
            <h3 class="text-lg font-bold mb-2 text-gray-900">iPhoneのサイドローディングとは？</h3>
            <p class="text-sm text-gray-600">App Storeに頼らない新しいアプリの入手方法をご紹介</p>
          </a>
          <a href={`${base}articles/how-to-use-altstore`} class="bg-white rounded-xl p-6 border border-gray-200 hover:border-gray-300 hover:shadow-md transition-all">
            <h3 class="text-lg font-bold mb-2 text-gray-900">AltStoreの使い方</h3>
            <p class="text-sm text-gray-600">7日署名問題とWi-Fi自動更新の仕組みを解説</p>
          </a>
          <a href={`${base}articles/install-app-step-by-step`} class="bg-white rounded-xl p-6 border border-gray-200 hover:border-gray-300 hover:shadow-md transition-all">
            <h3 class="text-lg font-bold mb-2 text-gray-900">アプリをインストールする方法</h3>
            <p class="text-sm text-gray-600">PC準備からインストール、メンテナンスまで完全ガイド</p>
          </a>
          <a href={`${base}articles/safety-guide`} class="bg-white rounded-xl p-6 border border-gray-200 hover:border-gray-300 hover:shadow-md transition-all">
            <h3 class="text-lg font-bold mb-2 text-gray-900">野良アプリの安全ガイド</h3>
            <p class="text-sm text-gray-600">ウイルスから身を守る3つの鉄則</p>
          </a>
          <a href={`${base}articles/emulator-legal`} class="bg-white rounded-xl p-6 border border-gray-200 hover:border-gray-300 hover:shadow-md transition-all">
            <h3 class="text-lg font-bold mb-2 text-gray-900">エミュレータと著作権</h3>
            <p class="text-sm text-gray-600">日本国内での正しい遊び方を弁護士視点で解説</p>
          </a>
          <a href={`${base}articles/utm-windows-on-ios`} class="bg-white rounded-xl p-6 border border-gray-200 hover:border-gray-300 hover:shadow-md transition-all">
            <h3 class="text-lg font-bold mb-2 text-gray-900">UTMで仮想化を活用</h3>
            <p class="text-sm text-gray-600">iPadでWindowsやLinuxを動かす活用事例</p>
          </a>
          <a href={`${base}articles/`} class="bg-white rounded-xl p-6 border border-gray-200 hover:border-gray-300 hover:shadow-md transition-all">
            <h3 class="text-lg font-bold mb-2 text-gray-900">すべての記事を見る</h3>
            <p class="text-sm text-gray-600">法律、安全性、アプリ紹介など全記事一覧</p>
          </a>
        </div>
      </div>
    </section>

    <!-- FAQ -->
    <section class="py-12 sm:py-14 lg:py-16 px-4 bg-gray-50">
      <div class="max-w-2xl mx-auto space-y-6">
        <h2 class="text-3xl font-bold text-center mb-12 text-gray-900">よくある質問</h2>
        {[
          {
            q: 'Q. サイドローディングって危なくない？',
            a: '大丈夫です。このサイトで紹介しているアプリは、開発元がはっきりしている公式アプリのみを扱っています。具体的には、オープンソースで透明性が確保されているエミュレータや、Appleの公証を受けたクリエイターアプリなど、それぞれのアプリの性質に合わせた安全確認を行っています。',
            tip: 'このサイト以外から野良アプリを入れる時は注意してください。信頼できるリポジトリからインストールすることが何より大切です。',
          },
          {
            q: 'Q. AltStoreでうまくインストールできない時は？',
            a: 'よくある原因をチェックしてみてください：<ul class="list-disc list-inside mb-4 space-y-2"><li>PCとiPhoneがちゃんと繋がってる？</li><li>Apple IDのパスワードは合ってる？</li><li>PCのファイアウォール（セキュリティ）で遮られてない？</li><li>AltStoreとiOSは最新版？</li></ul>',
            tip: `ステップバイステップで見たい場合：「<a href="${base}articles/install-app-step-by-step" class="font-bold underline">アプリをインストールする方法</a>」で画像付きで説明しています。`,
          },
          {
            q: 'Q. 「7日署名」って何？',
            a: 'サイドローディングしたアプリは、7日ごとに「署名」という許可証を更新しないと使えなくなります。でも心配しないで。このサイトで紹介しているアプリはほとんどがWi-Fi接続時に自動更新されるので、あなたが何かする必要はありません。',
            tip: '新しいAltStoreなら自動更新に対応しているので、インストール後は放っておいても大丈夫。',
          },
          {
            q: 'Q. ここのアプリって本当に安全？',
            a: 'はい、安全です。このサイトで紹介しているアプリは、すべて開発者の公式リポジトリから直接データを取得しており、改ざんのリスクがありません。エミュレータ（Delta、UTMなど）はオープンソースで誰でもコードを確認でき、透明性が確保されています。クリエイターアプリについては、Appleの公証を受けたものを扱います。',
            tip: '開発元がはっきりしており、公式ソースから取得しているため、出どころ不明な野良アプリとは根本的に違います。ただ、他のサイトから入れるときは注意してください。',
          },
        ].map(item => (
          <details class="group bg-white rounded-xl border border-gray-200 p-4 shadow-sm transition">

            <!-- 質問ヘッダー（常時表示） -->
            <summary class="cursor-pointer flex items-center gap-3 list-none">

              <img
                src={`${base}assets/img/buncho.png`}
                alt="ぶんちゃん"
                class="w-8 h-8 rounded-full bg-sky-100 border border-blue-200 flex-shrink-0"
              />

              <h3 class="font-semibold text-sm text-gray-900 flex-1">
                {item.q}
              </h3>

              <!-- 開閉アイコン -->
              <span class="text-gray-400 transition group-open:rotate-180">⌄</span>
            </summary>


            <!-- 回答（開いたときだけ表示・SEOには有効） -->
            <div class="mt-3 ml-11 text-sm text-gray-600 leading-6 space-y-3">

              <p set:html={item.a} />

              <p
                class="bg-blue-50 text-blue-800 px-3 py-2 rounded-lg text-xs leading-5"
                set:html={`<strong>ポイント：</strong> ${item.tip}`}
              />

            </div>

          </details>
        ))}
      </div>
    </section>
  </main>

  <script>
    let currentSlide = 0;
    let slideInterval: ReturnType<typeof setInterval> | undefined;
    let featuredApps: any[] = [];

    async function loadFeaturedApps() {
      const mobileContainer = document.getElementById('featured-apps-mobile');
      const desktopContainer = document.getElementById('featured-apps-desktop');
      const dotsContainer = document.getElementById('dots-container');
      const loadingElement = document.getElementById('apps-loading');
      const appsContent = document.getElementById('apps-content');

      try {
        const response = await fetch('https://script.google.com/macros/s/AKfycbxcaYOnyNaovd0ERTnVKKRxZP0x4eWSftKk-mMVCXZrbuQDw8e-aPN9sj4dSDPoGYeBsg/exec');
        const data = await response.json();
        featuredApps = data.apps.slice(0, 3);

        featuredApps.forEach((app: any, index: number) => {
          const distributionCategory = app.distributionInfo?.category || 'sideload';
          const distributionBadge = distributionCategory === 'official'
            ? '<span class="inline-block bg-green-100 text-green-700 text-[10px] px-2 py-0.5 rounded-md ml-1">App Store配信</span>'
            : '<span class="inline-block bg-yellow-100 text-yellow-700 text-[10px] px-2 py-0.5 rounded-md ml-1">IPA配布</span>';

          const cardHTML = `
            <div class="flex items-start gap-4">
              <img src="${app.iconURL}" alt="${app.name}" class="w-20 h-20 rounded-[22%] border border-gray-100 shadow-sm flex-shrink-0">
              <div class="grid grid-cols-[1fr_auto] gap-4">
                <div>
                  <h3 class="font-bold text-lg text-gray-900 leading-tight line-clamp-1">${app.name}</h3>
                  <p class="text-sm text-gray-500 mb-2">${app.developerName}</p>
                </div>
                <button class="bg-gray-100 text-gray-700 font-bold text-xs sm:text-sm px-5 py-1.5 rounded-full whitespace-nowrap ml-3" onclick="window.location.href='${import.meta.env.BASE_URL}app-detail?id=${app.bundleIdentifier}'">詳細</button>
                <div class="flex flex-wrap items-center gap-1 col-span-2">
                  <span class="inline-block bg-gray-100 text-gray-500 text-[10px] px-2 py-0.5 rounded-md">${app.category}</span>
                  ${distributionBadge}
                </div>
              </div>
            </div>
          `;

          if (mobileContainer) {
            const mobileCard = document.createElement('div');
            mobileCard.className = 'app-card flex flex-col flex-shrink-0 w-full max-w-md mx-auto';
            mobileCard.innerHTML = cardHTML;
            mobileContainer.appendChild(mobileCard);
          }

          if (desktopContainer) {
            const desktopCard = document.createElement('div');
            desktopCard.className = 'app-card flex flex-col';
            desktopCard.innerHTML = cardHTML;
            desktopContainer.appendChild(desktopCard);
          }

          if (dotsContainer) {
            const dot = document.createElement('button');
            dot.className = 'w-2 h-2 rounded-full transition-all duration-300 ' + (index === 0 ? 'bg-blue-600 w-8' : 'bg-gray-300');
            dot.addEventListener('click', () => goToSlide(index));
            dotsContainer.appendChild(dot);
          }
        });

        loadingElement?.classList.add('hidden');
        appsContent?.classList.remove('hidden');
        initSlideshow();

      } catch (error) {
        console.error('Failed to load apps:', error);
        loadingElement?.classList.add('hidden');
        if (appsContent) {
          appsContent.classList.remove('hidden');
          if (mobileContainer) mobileContainer.innerHTML = '<p class="text-red-600 p-4">アプリの読み込みに失敗しました</p>';
          if (desktopContainer) desktopContainer.innerHTML = '<p class="text-red-600 p-4 col-span-3 text-center">アプリの読み込みに失敗しました</p>';
        }
      }
    }

    function initSlideshow() {
      document.getElementById('prev-btn')?.addEventListener('click', prevSlide);
      document.getElementById('next-btn')?.addEventListener('click', nextSlide);
      startAutoPlay();
    }

    function goToSlide(index: number) {
      const container = document.getElementById('featured-apps-mobile');
      const dotsContainer = document.getElementById('dots-container');
      if (!container || !dotsContainer) return;
      currentSlide = index;
      container.style.transform = `translateX(${-currentSlide * 100}%)`;
      Array.from(dotsContainer.children).forEach((dot, i) => {
        dot.className = 'w-2 h-2 rounded-full transition-all duration-300 ' + (i === currentSlide ? 'bg-blue-600 w-8' : 'bg-gray-300');
      });
      stopAutoPlay();
      startAutoPlay();
    }

    function nextSlide() { goToSlide((currentSlide + 1) % featuredApps.length); }
    function prevSlide() { goToSlide((currentSlide - 1 + featuredApps.length) % featuredApps.length); }
    function startAutoPlay() { slideInterval = setInterval(nextSlide, 5000); }
    function stopAutoPlay() { if (slideInterval) clearInterval(slideInterval); }

    loadFeaturedApps();
  </script>
</BaseLayout>
